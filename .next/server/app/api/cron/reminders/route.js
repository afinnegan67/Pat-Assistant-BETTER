"use strict";(()=>{var e={};e.id=50,e.ids=[50],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},7843:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>O,patchFetch:()=>$,requestAsyncStorage:()=>_,routeModule:()=>y,serverHooks:()=>k,staticGenerationAsyncStorage:()=>v});var a={};r.r(a),r.d(a,{GET:()=>w,POST:()=>h});var n=r(9303),i=r(8716),s=r(670),o=r(7070),c=r(2374),d=r(1491),l=r(9313);let u=`You generate proactive reminders for Patrick. You check for:
- Tasks overdue by 1+ days (remind daily)
- Recurring tasks that are due
- Project events coming up within reminder window

Generate contextual, useful reminders. Not robotic pings.

For overdue tasks: "The Home Depot return is 3 days overdue. That's $600 sitting in the truck."

For upcoming project events: "Johnson deck kicks off in 5 days. Have you lined up subs? Want me to draft the client email?"

Be direct. Create urgency where appropriate. Offer to help where the system can help.

Generate a single reminder message that covers the most important items. Keep it under 3-4 sentences unless there are many urgent items.`;function p(e){let t=[`"${e.description}"`];if(e.deadline){let r=new Date(e.deadline),a=Math.floor((new Date().getTime()-r.getTime())/864e5);a>0&&t.push(`(${a} day${1===a?"":"s"} overdue)`)}return"urgent"===e.priority?t.push("[URGENT]"):"high"===e.priority&&t.push("[high priority]"),t.join(" ")}async function m(){try{let e=await (0,l.fP)();if(0===e.length)return{reminders:[],taskIds:[]};let t=e.filter(e=>"urgent"===e.priority),r=e.filter(e=>"high"===e.priority),a=e.filter(e=>"urgent"!==e.priority&&"high"!==e.priority),n=[...t.map(e=>`URGENT: ${p(e)}`),...r.map(e=>`HIGH: ${p(e)}`),...a.slice(0,5).map(e=>p(e))].join("\n"),{text:i}=await (0,c._4)({model:d.bt,system:u,prompt:`Tasks needing attention (${e.length} total):
${n}

Generate a reminder message for Patrick. Be direct and create appropriate urgency.`}),s=e.map(e=>e.id);return await Promise.all(s.map(e=>(0,l.pj)(e))),{reminders:[i.trim()],taskIds:s}}catch(e){return console.error("Reminder generation error:",e),{reminders:[],taskIds:[]}}}var g=r(2126);let f=process.env.CRON_SECRET;async function w(e){try{if(f&&e.headers.get("authorization")!==`Bearer ${f}`)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{reminders:t,taskIds:r}=await m();if(0===t.length)return o.NextResponse.json({success:!0,remindersSent:0,message:"No reminders needed"});for(let e of t)await (0,g._b)(e);return o.NextResponse.json({success:!0,remindersSent:t.length,tasksReminded:r.length})}catch(e){console.error("Reminders error:",e);try{await (0,g._b)("Your nephew Aidan failed to build me correctly. Blame him not me. (Reminders failed)")}catch(e){console.error("Failed to send error notification:",e)}return o.NextResponse.json({error:"Reminders failed",details:e.message},{status:500})}}async function h(e){return w(e)}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cron/reminders/route",pathname:"/api/cron/reminders",filename:"route",bundlePath:"app/api/cron/reminders/route"},resolvedPagePath:"C:\\Users\\aidan\\OneDrive\\Documents\\Pats Assitant Improved\\app\\api\\cron\\reminders\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:_,staticGenerationAsyncStorage:v,serverHooks:k}=y,O="/api/cron/reminders/route";function $(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:v})}},9313:(e,t,r)=>{r.d(t,{$3:()=>A,$L:()=>k,AF:()=>j,E5:()=>_,Kv:()=>i,ME:()=>R,RJ:()=>s,Rp:()=>$,TK:()=>g,W9:()=>m,Wl:()=>u,Yw:()=>S,_i:()=>n,fP:()=>h,hR:()=>w,iY:()=>P,ib:()=>E,kD:()=>c,km:()=>v,pj:()=>y,tR:()=>F,ty:()=>O,vr:()=>d,xJ:()=>l,yJ:()=>f,yW:()=>p,zE:()=>o,zx:()=>T});var a=r(964);async function n(){let{data:e,error:t}=await a.O.rpc("get_or_create_conversation");if(t)throw Error(`Failed to get/create conversation: ${t.message}`);return e}async function i(){let{error:e}=await a.O.rpc("close_old_conversations");if(e)throw Error(`Failed to close old conversations: ${e.message}`)}async function s(e){let{data:t,error:r}=await a.O.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(r)throw Error(`Failed to get messages: ${r.message}`);return t}async function o(e,t,r,n){let{data:i,error:s}=await a.O.from("messages").insert({conversation_id:e,role:t,content:r,active_context:n}).select().single();if(s)throw Error(`Failed to save message: ${s.message}`);return await a.O.from("conversations").update({last_activity:new Date().toISOString()}).eq("id",e),i}async function c(e){let{data:t,error:r}=await a.O.from("messages").select("active_context").eq("conversation_id",e).order("created_at",{ascending:!1}).limit(1).single();return r||!t?null:t.active_context}async function d(e){let{data:t,error:r}=await a.O.from("tasks").insert({description:e.description,project_id:e.project_id||null,deadline:e.deadline||null,priority:e.priority||"medium",is_recurring:e.is_recurring||!1,recurrence_rule:e.recurrence_rule||null}).select().single();if(r)throw Error(`Failed to create task: ${r.message}`);return t}async function l(e,t){let{data:r,error:n}=await a.O.from("tasks").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update task: ${n.message}`);return r}async function u(e){let{data:t,error:r}=await a.O.from("tasks").update({status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw Error(`Failed to complete task: ${r.message}`);return t}async function p(e){let{data:t,error:r}=await a.O.from("tasks").select("*").eq("id",e).single();return r?null:t}async function m(e){let{data:t,error:r}=await a.O.from("tasks").select("*").eq("project_id",e).neq("status","completed").order("created_at",{ascending:!1});if(r)throw Error(`Failed to get tasks: ${r.message}`);return t}async function g(){let{data:e,error:t}=await a.O.from("tasks").select("*").eq("status","pending").order("priority",{ascending:!1}).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get pending tasks: ${t.message}`);return e}async function f(){let{data:e,error:t}=await a.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get overdue tasks: ${t.message}`);return e}async function w(){let e=new Date,t=new Date(e.setHours(0,0,0,0)).toISOString(),r=new Date(e.setHours(23,59,59,999)).toISOString(),{data:n,error:i}=await a.O.from("tasks").select("*").eq("status","pending").gte("deadline",t).lte("deadline",r).order("priority",{ascending:!1});if(i)throw Error(`Failed to get today's tasks: ${i.message}`);return n}async function h(){let e=new Date(Date.now()-864e5).toISOString(),{data:t,error:r}=await a.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).or(`last_reminded_at.is.null,last_reminded_at.lt.${e}`).order("deadline",{ascending:!0});if(r)throw Error(`Failed to get tasks needing reminder: ${r.message}`);return t}async function y(e){let{error:t}=await a.O.from("tasks").update({last_reminded_at:new Date().toISOString()}).eq("id",e);if(t)throw Error(`Failed to update task reminder: ${t.message}`)}async function _(e){let{data:t,error:r}=await a.O.from("tasks").select("*").ilike("description",`%${e}%`).neq("status","completed").order("created_at",{ascending:!1}).limit(10);if(r)throw Error(`Failed to search tasks: ${r.message}`);return t}async function v(){let{data:e,error:t}=await a.O.from("tasks").select("*").neq("status","completed").order("created_at",{ascending:!1});if(t)throw Error(`Failed to get all tasks: ${t.message}`);return e}async function k(e){let{data:t,error:r}=await a.O.from("projects").insert({name:e.name,client_name:e.client_name||null,address:e.address||null,project_type:e.project_type||null,status:e.status||"future"}).select().single();if(r)throw Error(`Failed to create project: ${r.message}`);return t}async function O(e,t){let{data:r,error:n}=await a.O.from("projects").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update project: ${n.message}`);return r}async function $(e){let{data:t,error:r}=await a.O.from("projects").select("*").eq("id",e).single();return r?null:t}async function E(e){let{data:t,error:r}=await a.O.from("projects").select("*").ilike("name",e).limit(1).single();return r?null:t}async function S(){let{data:e,error:t}=await a.O.from("projects").select("*").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get projects: ${t.message}`);return e}async function j(){let{data:e,error:t}=await a.O.from("projects").select("*").eq("status","active").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get active projects: ${t.message}`);return e}async function F(e){let{data:t,error:r}=await a.O.from("project_knowledge").insert({project_id:e.project_id||null,content:e.content,embedding:e.embedding,source_type:e.source_type,source_id:e.source_id||null}).select().single();if(r)throw Error(`Failed to add knowledge: ${r.message}`);return t}async function T(e){let{data:t,error:r}=await a.O.from("project_knowledge").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(r)throw Error(`Failed to get project knowledge: ${r.message}`);return t}async function R(e){let{data:t,error:r}=await a.O.from("voice_transcripts").insert({raw_content:e.raw_content,duration_seconds:e.duration_seconds||null,source:e.source}).select().single();if(r)throw Error(`Failed to save transcript: ${r.message}`);return t}async function A(e,t){let{error:r}=await a.O.from("voice_transcripts").update({processed:!0,processed_at:new Date().toISOString(),processing_summary:t}).eq("id",e);if(r)throw Error(`Failed to update transcript: ${r.message}`)}async function P(e){let{data:t,error:r}=await a.O.from("daily_briefs").insert({brief_date:e.brief_date,content:e.content,tasks_included:e.tasks_included}).select().single();if(r)throw Error(`Failed to save daily brief: ${r.message}`);return t}},964:(e,t,r)=>{r.d(t,{O:()=>o});var a=r(7857);let n=process.env.SUPABASE_URL,i=process.env.SUPABASE_ANON_KEY,s=null,o=s=(0,a.eI)(n,i)},1491:(e,t,r)=>{r.d(t,{bt:()=>c,pr:()=>d});var a=r(5815);let n=process.env.OPENROUTER_API_KEY,i=process.env.APP_URL||"https://patricks-assistant.vercel.app",s=(0,a.cZ)({name:"openrouter",baseURL:"https://openrouter.ai/api/v1",headers:{Authorization:`Bearer ${n}`,"HTTP-Referer":i,"X-Title":"Patricks Assistant"}}),o={FAST:"x-ai/grok-4.1-fast",SMART:"google/gemini-3-flash-preview"},c=s(o.FAST),d=s(o.SMART)},2126:(e,t,r)=>{r.d(t,{_P:()=>p,_b:()=>c,bG:()=>o,kN:()=>u,mo:()=>m,zh:()=>d});let a=process.env.TELEGRAM_BOT_TOKEN,n=`https://api.telegram.org/bot${a}`,i=process.env.PATRICK_TELEGRAM_ID;async function s(e,t,r=5){let a=null;for(let i=0;i<r;i++)try{let r=new AbortController,a=setTimeout(()=>r.abort(),3e4),i=await fetch(`${n}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0,signal:r.signal});clearTimeout(a);let s=await i.json();if(!s.ok)throw Error(`Telegram API error: ${s.description}`);return s.result}catch(e){if(a=e,console.error(`Telegram API attempt ${i+1}/${r} failed:`,e),i<r-1){let e=1e3*Math.pow(2,i);console.log(`Retrying in ${e}ms...`),await new Promise(t=>setTimeout(t,e))}}throw a||Error("Failed to call Telegram API after retries")}async function o(e,t){await s("sendMessage",{chat_id:e,text:t,parse_mode:"HTML"})}async function c(e){await o(i,e)}async function d(e){await s("sendChatAction",{chat_id:e,action:"typing"})}async function l(e){return await s("getFile",{file_id:e})}async function u(e){let t=await l(e),r=`https://api.telegram.org/file/bot${a}/${t.file_path}`,n=await fetch(r);if(!n.ok)throw Error(`Failed to download voice note: ${n.status}`);let i=await n.arrayBuffer();return Buffer.from(i)}function p(e,t){return e===t}async function m(e){let t=`Your nephew Aidan failed to build me correctly. Blame him not me.

Context: ${e}`;await c(t)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,460],()=>r(7843));module.exports=a})();