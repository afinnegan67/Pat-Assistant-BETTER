"use strict";exports.id=550,exports.ids=[550],exports.modules={9313:(e,t,r)=>{r.d(t,{$3:()=>I,$L:()=>E,AF:()=>T,E5:()=>h,Kv:()=>o,ME:()=>A,RJ:()=>s,Rp:()=>S,TK:()=>p,W9:()=>m,Wl:()=>u,Yw:()=>v,_i:()=>n,fP:()=>_,hR:()=>w,iY:()=>P,ib:()=>k,kD:()=>c,km:()=>O,pj:()=>y,tR:()=>F,ty:()=>$,vr:()=>l,xJ:()=>d,yJ:()=>g,yW:()=>f,zE:()=>i,zx:()=>j});var a=r(964);async function n(){let{data:e,error:t}=await a.O.rpc("get_or_create_conversation");if(t)throw Error(`Failed to get/create conversation: ${t.message}`);return e}async function o(){let{error:e}=await a.O.rpc("close_old_conversations");if(e)throw Error(`Failed to close old conversations: ${e.message}`)}async function s(e){let{data:t,error:r}=await a.O.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(r)throw Error(`Failed to get messages: ${r.message}`);return t}async function i(e,t,r,n){let{data:o,error:s}=await a.O.from("messages").insert({conversation_id:e,role:t,content:r,active_context:n}).select().single();if(s)throw Error(`Failed to save message: ${s.message}`);return await a.O.from("conversations").update({last_activity:new Date().toISOString()}).eq("id",e),o}async function c(e){let{data:t,error:r}=await a.O.from("messages").select("active_context").eq("conversation_id",e).order("created_at",{ascending:!1}).limit(1).single();return r||!t?null:t.active_context}async function l(e){let{data:t,error:r}=await a.O.from("tasks").insert({description:e.description,project_id:e.project_id||null,deadline:e.deadline||null,priority:e.priority||"medium",is_recurring:e.is_recurring||!1,recurrence_rule:e.recurrence_rule||null}).select().single();if(r)throw Error(`Failed to create task: ${r.message}`);return t}async function d(e,t){let{data:r,error:n}=await a.O.from("tasks").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update task: ${n.message}`);return r}async function u(e){let{data:t,error:r}=await a.O.from("tasks").update({status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw Error(`Failed to complete task: ${r.message}`);return t}async function f(e){let{data:t,error:r}=await a.O.from("tasks").select("*").eq("id",e).single();return r?null:t}async function m(e){let{data:t,error:r}=await a.O.from("tasks").select("*").eq("project_id",e).neq("status","completed").order("created_at",{ascending:!1});if(r)throw Error(`Failed to get tasks: ${r.message}`);return t}async function p(){let{data:e,error:t}=await a.O.from("tasks").select("*").eq("status","pending").order("priority",{ascending:!1}).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get pending tasks: ${t.message}`);return e}async function g(){let{data:e,error:t}=await a.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get overdue tasks: ${t.message}`);return e}async function w(){let e=new Date,t=new Date(e.setHours(0,0,0,0)).toISOString(),r=new Date(e.setHours(23,59,59,999)).toISOString(),{data:n,error:o}=await a.O.from("tasks").select("*").eq("status","pending").gte("deadline",t).lte("deadline",r).order("priority",{ascending:!1});if(o)throw Error(`Failed to get today's tasks: ${o.message}`);return n}async function _(){let e=new Date(Date.now()-864e5).toISOString(),{data:t,error:r}=await a.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).or(`last_reminded_at.is.null,last_reminded_at.lt.${e}`).order("deadline",{ascending:!0});if(r)throw Error(`Failed to get tasks needing reminder: ${r.message}`);return t}async function y(e){let{error:t}=await a.O.from("tasks").update({last_reminded_at:new Date().toISOString()}).eq("id",e);if(t)throw Error(`Failed to update task reminder: ${t.message}`)}async function h(e){let{data:t,error:r}=await a.O.from("tasks").select("*").ilike("description",`%${e}%`).neq("status","completed").order("created_at",{ascending:!1}).limit(10);if(r)throw Error(`Failed to search tasks: ${r.message}`);return t}async function O(){let{data:e,error:t}=await a.O.from("tasks").select("*").neq("status","completed").order("created_at",{ascending:!1});if(t)throw Error(`Failed to get all tasks: ${t.message}`);return e}async function E(e){let{data:t,error:r}=await a.O.from("projects").insert({name:e.name,client_name:e.client_name||null,address:e.address||null,project_type:e.project_type||null,status:e.status||"future"}).select().single();if(r)throw Error(`Failed to create project: ${r.message}`);return t}async function $(e,t){let{data:r,error:n}=await a.O.from("projects").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update project: ${n.message}`);return r}async function S(e){let{data:t,error:r}=await a.O.from("projects").select("*").eq("id",e).single();return r?null:t}async function k(e){let{data:t,error:r}=await a.O.from("projects").select("*").ilike("name",e).limit(1).single();return r?null:t}async function v(){let{data:e,error:t}=await a.O.from("projects").select("*").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get projects: ${t.message}`);return e}async function T(){let{data:e,error:t}=await a.O.from("projects").select("*").eq("status","active").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get active projects: ${t.message}`);return e}async function F(e){let{data:t,error:r}=await a.O.from("project_knowledge").insert({project_id:e.project_id||null,content:e.content,embedding:e.embedding,source_type:e.source_type,source_id:e.source_id||null}).select().single();if(r)throw Error(`Failed to add knowledge: ${r.message}`);return t}async function j(e){let{data:t,error:r}=await a.O.from("project_knowledge").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(r)throw Error(`Failed to get project knowledge: ${r.message}`);return t}async function A(e){let{data:t,error:r}=await a.O.from("voice_transcripts").insert({raw_content:e.raw_content,duration_seconds:e.duration_seconds||null,source:e.source}).select().single();if(r)throw Error(`Failed to save transcript: ${r.message}`);return t}async function I(e,t){let{error:r}=await a.O.from("voice_transcripts").update({processed:!0,processed_at:new Date().toISOString(),processing_summary:t}).eq("id",e);if(r)throw Error(`Failed to update transcript: ${r.message}`)}async function P(e){let{data:t,error:r}=await a.O.from("daily_briefs").insert({brief_date:e.brief_date,content:e.content,tasks_included:e.tasks_included}).select().single();if(r)throw Error(`Failed to save daily brief: ${r.message}`);return t}},964:(e,t,r)=>{r.d(t,{O:()=>i});var a=r(7857);let n=process.env.SUPABASE_URL,o=process.env.SUPABASE_ANON_KEY,s=null,i=s=(0,a.eI)(n,o)},3240:(e,t,r)=>{r.d(t,{Pl:()=>u,Py:()=>d});let a=process.env.GOOGLE_CLIENT_ID,n=process.env.GOOGLE_CLIENT_SECRET,o=process.env.GOOGLE_REFRESH_TOKEN,s=null,i=0;async function c(){if(s&&Date.now()<i-6e4)return s;let e=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:a,client_secret:n,refresh_token:o,grant_type:"refresh_token"})});if(!e.ok){let t=await e.text();throw Error(`Failed to refresh Google token: ${t}`)}let t=await e.json(),r=t.access_token;return s=r,i=Date.now()+1e3*t.expires_in,r}async function l(e,t){let r=await c(),a=new URL(`https://www.googleapis.com/calendar/v3${e}`);t&&Object.entries(t).forEach(([e,t])=>{a.searchParams.append(e,t)});let n=await fetch(a.toString(),{headers:{Authorization:`Bearer ${r}`}});if(!n.ok){let e=await n.text();throw Error(`Google Calendar API error: ${e}`)}return n.json()}async function d(){let e=new Date,t=e.getTimezoneOffset(),r=new Date(e.getTime()+(t- -480)*6e4),a=new Date(r);a.setHours(0,0,0,0);let n=new Date(r);return n.setHours(23,59,59,999),((await l("/calendars/primary/events",{timeMin:a.toISOString(),timeMax:n.toISOString(),singleEvents:"true",orderBy:"startTime"})).items||[]).map(e=>({id:e.id,summary:e.summary||"No title",start:e.start.dateTime||e.start.date||"",end:e.end.dateTime||e.end.date||"",location:e.location}))}function u(e){return 0===e.length?"No calendar events today.":e.map(e=>{let t=function(e){let t=new Date(e.start),r=t.getHours(),a=t.getMinutes().toString().padStart(2,"0");return`${r%12||12}:${a}${r>=12?"pm":"am"}`}(e),r=e.location?` at ${e.location}`:"";return`${t} ${e.summary}${r}`}).join("\n")}},1931:(e,t,r)=>{r.d(t,{XZ:()=>i,aN:()=>l,fb:()=>c});let a=process.env.OPENROUTER_API_KEY,n=process.env.APP_URL||"https://patricks-assistant.vercel.app",o={FAST:"x-ai/grok-4.1-fast",SMART:"google/gemini-3-flash-preview"};async function s(e,t,r=3){let o=null;for(let s=0;s<r;s++)try{let r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json","HTTP-Referer":n,"X-Title":"Patricks Assistant"},body:JSON.stringify({model:e,messages:t,temperature:.7})});if(!r.ok){let e=await r.text();throw Error(`OpenRouter API error: ${r.status} - ${e}`)}return(await r.json()).choices[0].message.content}catch(e){o=e,console.error(`Attempt ${s+1} failed:`,e),s<r-1&&await new Promise(e=>setTimeout(e,1e3*Math.pow(2,s)))}throw o||Error("Failed to call OpenRouter after retries")}async function i(e){return s(o.FAST,e)}async function c(e){return s(o.SMART,e)}async function l(e){let t=await i(e),r=t.match(/\{[\s\S]*\}/);if(!r)throw Error("No JSON found in response");try{return JSON.parse(r[0])}catch(e){throw Error(`Failed to parse JSON response: ${t}`)}}},2126:(e,t,r)=>{r.d(t,{_P:()=>f,_b:()=>c,bG:()=>i,kN:()=>u,mo:()=>m,zh:()=>l});let a=process.env.TELEGRAM_BOT_TOKEN,n=`https://api.telegram.org/bot${a}`,o=process.env.PATRICK_TELEGRAM_ID;async function s(e,t,r=3){let a=null;for(let o=0;o<r;o++)try{let r=await fetch(`${n}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0}),a=await r.json();if(!a.ok)throw Error(`Telegram API error: ${a.description}`);return a.result}catch(e){a=e,console.error(`Telegram API attempt ${o+1} failed:`,e),o<r-1&&await new Promise(e=>setTimeout(e,1e3*Math.pow(2,o)))}throw a||Error("Failed to call Telegram API after retries")}async function i(e,t){await s("sendMessage",{chat_id:e,text:t,parse_mode:"HTML"})}async function c(e){await i(o,e)}async function l(e){await s("sendChatAction",{chat_id:e,action:"typing"})}async function d(e){return await s("getFile",{file_id:e})}async function u(e){let t=await d(e),r=`https://api.telegram.org/file/bot${a}/${t.file_path}`,n=await fetch(r);if(!n.ok)throw Error(`Failed to download voice note: ${n.status}`);let o=await n.arrayBuffer();return Buffer.from(o)}function f(e,t){return e===t}async function m(e){let t=`Your nephew Aidan failed to build me correctly. Blame him not me.

Context: ${e}`;await c(t)}}};