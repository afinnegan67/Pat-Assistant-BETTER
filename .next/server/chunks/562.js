"use strict";exports.id=562,exports.ids=[562],exports.modules={5090:(e,t,a)=>{a.d(t,{C6:()=>o,pN:()=>l});var r=a(964);let n=process.env.OPENROUTER_API_KEY;async function o(e){let t=await fetch("https://openrouter.ai/api/v1/embeddings",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json","HTTP-Referer":process.env.APP_URL||"https://patricks-assistant.vercel.app","X-Title":"Patricks Assistant"},body:JSON.stringify({model:"openai/text-embedding-3-small",input:e})});if(!t.ok){let e=await t.text();throw Error(`Failed to generate embedding: ${e}`)}return(await t.json()).data[0].embedding}async function i(e,t=5,a){let n=r.O.rpc("match_knowledge",{query_embedding:e,match_threshold:.7,match_count:t}),{data:o,error:i}=await n;return i?(console.error("Vector search failed, falling back to simple query:",i.message),s(a,t)):o}async function s(e,t=5){let a=r.O.from("project_knowledge").select("*").order("created_at",{ascending:!1}).limit(t);e&&(a=a.eq("project_id",e));let{data:n,error:o}=await a;if(o)throw Error(`Failed to search knowledge: ${o.message}`);return n}async function l(e,t,a=5){try{let r=await o(e);return await i(r,a,t)}catch(e){return console.error("Embedding search failed:",e),s(t,a)}}},9313:(e,t,a)=>{a.d(t,{$3:()=>R,$L:()=>O,AF:()=>j,E5:()=>h,Kv:()=>o,ME:()=>q,RJ:()=>i,Rp:()=>v,TK:()=>f,W9:()=>m,Wl:()=>u,Yw:()=>b,_i:()=>n,fP:()=>w,hR:()=>g,iY:()=>T,ib:()=>$,kD:()=>l,km:()=>k,pj:()=>y,tR:()=>S,ty:()=>E,vr:()=>c,xJ:()=>d,yJ:()=>_,yW:()=>p,zE:()=>s,zx:()=>F});var r=a(964);async function n(){let{data:e,error:t}=await r.O.rpc("get_or_create_conversation");if(t)throw Error(`Failed to get/create conversation: ${t.message}`);return e}async function o(){let{error:e}=await r.O.rpc("close_old_conversations");if(e)throw Error(`Failed to close old conversations: ${e.message}`)}async function i(e){let{data:t,error:a}=await r.O.from("messages").select("*").eq("conversation_id",e).order("created_at",{ascending:!0});if(a)throw Error(`Failed to get messages: ${a.message}`);return t}async function s(e,t,a,n){let{data:o,error:i}=await r.O.from("messages").insert({conversation_id:e,role:t,content:a,active_context:n}).select().single();if(i)throw Error(`Failed to save message: ${i.message}`);return await r.O.from("conversations").update({last_activity:new Date().toISOString()}).eq("id",e),o}async function l(e){let{data:t,error:a}=await r.O.from("messages").select("active_context").eq("conversation_id",e).order("created_at",{ascending:!1}).limit(1).single();return a||!t?null:t.active_context}async function c(e){let{data:t,error:a}=await r.O.from("tasks").insert({description:e.description,project_id:e.project_id||null,deadline:e.deadline||null,priority:e.priority||"medium",is_recurring:e.is_recurring||!1,recurrence_rule:e.recurrence_rule||null}).select().single();if(a)throw Error(`Failed to create task: ${a.message}`);return t}async function d(e,t){let{data:a,error:n}=await r.O.from("tasks").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update task: ${n.message}`);return a}async function u(e){let{data:t,error:a}=await r.O.from("tasks").update({status:"completed",completed_at:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();if(a)throw Error(`Failed to complete task: ${a.message}`);return t}async function p(e){let{data:t,error:a}=await r.O.from("tasks").select("*").eq("id",e).single();return a?null:t}async function m(e){let{data:t,error:a}=await r.O.from("tasks").select("*").eq("project_id",e).neq("status","completed").order("created_at",{ascending:!1});if(a)throw Error(`Failed to get tasks: ${a.message}`);return t}async function f(){let{data:e,error:t}=await r.O.from("tasks").select("*").eq("status","pending").order("priority",{ascending:!1}).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get pending tasks: ${t.message}`);return e}async function _(){let{data:e,error:t}=await r.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).order("deadline",{ascending:!0});if(t)throw Error(`Failed to get overdue tasks: ${t.message}`);return e}async function g(){let e=new Date,t=new Date(e.setHours(0,0,0,0)).toISOString(),a=new Date(e.setHours(23,59,59,999)).toISOString(),{data:n,error:o}=await r.O.from("tasks").select("*").eq("status","pending").gte("deadline",t).lte("deadline",a).order("priority",{ascending:!1});if(o)throw Error(`Failed to get today's tasks: ${o.message}`);return n}async function w(){let e=new Date(Date.now()-864e5).toISOString(),{data:t,error:a}=await r.O.from("tasks").select("*").eq("status","pending").lt("deadline",new Date().toISOString()).or(`last_reminded_at.is.null,last_reminded_at.lt.${e}`).order("deadline",{ascending:!0});if(a)throw Error(`Failed to get tasks needing reminder: ${a.message}`);return t}async function y(e){let{error:t}=await r.O.from("tasks").update({last_reminded_at:new Date().toISOString()}).eq("id",e);if(t)throw Error(`Failed to update task reminder: ${t.message}`)}async function h(e){let{data:t,error:a}=await r.O.from("tasks").select("*").ilike("description",`%${e}%`).neq("status","completed").order("created_at",{ascending:!1}).limit(10);if(a)throw Error(`Failed to search tasks: ${a.message}`);return t}async function k(){let{data:e,error:t}=await r.O.from("tasks").select("*").neq("status","completed").order("created_at",{ascending:!1});if(t)throw Error(`Failed to get all tasks: ${t.message}`);return e}async function O(e){let{data:t,error:a}=await r.O.from("projects").insert({name:e.name,client_name:e.client_name||null,address:e.address||null,project_type:e.project_type||null,status:e.status||"future"}).select().single();if(a)throw Error(`Failed to create project: ${a.message}`);return t}async function E(e,t){let{data:a,error:n}=await r.O.from("projects").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw Error(`Failed to update project: ${n.message}`);return a}async function v(e){let{data:t,error:a}=await r.O.from("projects").select("*").eq("id",e).single();return a?null:t}async function $(e){let{data:t,error:a}=await r.O.from("projects").select("*").ilike("name",e).limit(1).single();return a?null:t}async function b(){let{data:e,error:t}=await r.O.from("projects").select("*").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get projects: ${t.message}`);return e}async function j(){let{data:e,error:t}=await r.O.from("projects").select("*").eq("status","active").order("updated_at",{ascending:!1});if(t)throw Error(`Failed to get active projects: ${t.message}`);return e}async function S(e){let{data:t,error:a}=await r.O.from("project_knowledge").insert({project_id:e.project_id||null,content:e.content,embedding:e.embedding,source_type:e.source_type,source_id:e.source_id||null}).select().single();if(a)throw Error(`Failed to add knowledge: ${a.message}`);return t}async function F(e){let{data:t,error:a}=await r.O.from("project_knowledge").select("*").eq("project_id",e).order("created_at",{ascending:!1});if(a)throw Error(`Failed to get project knowledge: ${a.message}`);return t}async function q(e){let{data:t,error:a}=await r.O.from("voice_transcripts").insert({raw_content:e.raw_content,duration_seconds:e.duration_seconds||null,source:e.source}).select().single();if(a)throw Error(`Failed to save transcript: ${a.message}`);return t}async function R(e,t){let{error:a}=await r.O.from("voice_transcripts").update({processed:!0,processed_at:new Date().toISOString(),processing_summary:t}).eq("id",e);if(a)throw Error(`Failed to update transcript: ${a.message}`)}async function T(e){let{data:t,error:a}=await r.O.from("daily_briefs").insert({brief_date:e.brief_date,content:e.content,tasks_included:e.tasks_included}).select().single();if(a)throw Error(`Failed to save daily brief: ${a.message}`);return t}},964:(e,t,a)=>{a.d(t,{O:()=>s});var r=a(7857);let n=process.env.SUPABASE_URL,o=process.env.SUPABASE_ANON_KEY,i=null,s=i=(0,r.eI)(n,o)},8618:(e,t,a)=>{a.d(t,{Bd:()=>y,Jk:()=>f,Xl:()=>c,dM:()=>p});var r=a(1067);let n=r.Km(["task_create","task_update","task_complete","task_query","project_create","project_update","project_query","schedule_query","knowledge_query","general_chat"]),o=r.Km(["low","medium","high","urgent"]),i=r.Km(["pending","completed","on_hold","cancelled"]),s=r.Km(["future","active","on_hold","completed"]),l=r.Km(["high","medium","low"]),c=r.Ry({intent:n,entities:r.Ry({projects:r.IX(r.Z_()).default([]),tasks:r.IX(r.Z_()).default([]),deadline:r.Z_().nullable().default(null),priority:o.nullable().default(null)}),requires_lookup:r.O7().default(!1),confidence:l.default("medium")}),d=r.Km(["create","update","complete","query"]),u=r.Km(["all","project","overdue","today","search"]),p=r.Ry({action:d,task_description:r.Z_().optional(),task_id:r.Z_().optional(),project_id:r.Z_().nullable().optional(),deadline:r.Z_().nullable().optional(),priority:o.nullable().optional(),updates:r.Ry({description:r.Z_().optional(),priority:o.optional(),deadline:r.Z_().optional(),status:i.optional()}).optional(),query_type:u.optional(),search_term:r.Z_().optional()}),m=r.Km(["create","update"]),f=r.Ry({action:m,name:r.Z_().optional(),project_id:r.Z_().optional(),client_name:r.Z_().nullable().optional(),address:r.Z_().nullable().optional(),project_type:r.Z_().nullable().optional(),status:s.nullable().optional()}),_=r.Ry({description:r.Z_(),project_name:r.Z_().nullable().default(null),deadline:r.Z_().nullable().default(null),priority:o.nullable().default(null)}),g=r.Ry({project_name:r.Z_().nullable().default(null),content:r.Z_()}),w=r.Ry({name:r.Z_(),client_name:r.Z_().nullable().default(null),project_type:r.Z_().nullable().default(null)}),y=r.Ry({tasks:r.IX(_).default([]),knowledge:r.IX(g).default([]),new_projects:r.IX(w).default([])})},1491:(e,t,a)=>{a.d(t,{bt:()=>l,pr:()=>c});var r=a(5815);let n=process.env.OPENROUTER_API_KEY,o=process.env.APP_URL||"https://patricks-assistant.vercel.app",i=(0,r.cZ)({name:"openrouter",baseURL:"https://openrouter.ai/api/v1",headers:{Authorization:`Bearer ${n}`,"HTTP-Referer":o,"X-Title":"Patricks Assistant"}}),s={FAST:"x-ai/grok-4.1-fast",SMART:"google/gemini-3-flash-preview"},l=i(s.FAST),c=i(s.SMART)},2126:(e,t,a)=>{a.d(t,{_P:()=>p,_b:()=>l,bG:()=>s,kN:()=>u,mo:()=>m,zh:()=>c});let r=process.env.TELEGRAM_BOT_TOKEN,n=`https://api.telegram.org/bot${r}`,o=process.env.PATRICK_TELEGRAM_ID;async function i(e,t,a=5){let r=null;for(let o=0;o<a;o++)try{let a=new AbortController,r=setTimeout(()=>a.abort(),3e4),o=await fetch(`${n}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0,signal:a.signal});clearTimeout(r);let i=await o.json();if(!i.ok)throw Error(`Telegram API error: ${i.description}`);return i.result}catch(e){if(r=e,console.error(`Telegram API attempt ${o+1}/${a} failed:`,e),o<a-1){let e=1e3*Math.pow(2,o);console.log(`Retrying in ${e}ms...`),await new Promise(t=>setTimeout(t,e))}}throw r||Error("Failed to call Telegram API after retries")}async function s(e,t){await i("sendMessage",{chat_id:e,text:t,parse_mode:"HTML"})}async function l(e){await s(o,e)}async function c(e){await i("sendChatAction",{chat_id:e,action:"typing"})}async function d(e){return await i("getFile",{file_id:e})}async function u(e){let t=await d(e),a=`https://api.telegram.org/file/bot${r}/${t.file_path}`,n=await fetch(a);if(!n.ok)throw Error(`Failed to download voice note: ${n.status}`);let o=await n.arrayBuffer();return Buffer.from(o)}function p(e,t){return e===t}async function m(e){let t=`Your nephew Aidan failed to build me correctly. Blame him not me.

Context: ${e}`;await l(t)}}};